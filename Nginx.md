>   Nginx的概念

Nginx 是一个轻量级、高性能的反向代理web服务器，用于 HTTP、HTTPS、SMTP、POP3  和 IMAP协议。可以实现高效的反向代理、负载均衡

>   为什么使用Nginx

-   跨平台、配置简单、方向代理、高并发连接：处理2-3万并发连接数，官方监测能支持5万并发， 内存消耗小：开启10个nginx才占150M内存，nginx处理静态文件好，耗费内存少
-   Nginx内置的健康检查功能：如果有一个服务器宕机，会做一个健康检查，再发送的请求就不 会发送到宕机的服务器了。重新将请求提交到其他的节点上
-   使用Nginx的话还能： 1. 节省宽带：支持GZIP压缩，可以添加浏览器本地缓存 2. 稳定性高：宕机的概率非常小 3. 接收用户请求是异步的

>   Nginx优缺点

-   优点： 1.占内存小，可实现高并发连接，处理响应快 2.可实现http服务器、虚拟主机、方向代理、负载均衡 3. Nginx配置简单  4. 可以不暴露正式的服务器IP地址
-   缺点：动态处理差：nginx处理静态文件好，耗费内存少，但是处理动态页面则很鸡肋，现在一般前端用nginx作为反向代理抗住压力

>   Nginx应用场景

1.   http服务器。Nginx是一个http服务可以独立提供http服务。可以做网页静态服务器
2.   虚拟主机。可以实现在一台服务器虚拟出多个网站，例如个人网站使用的虚拟机
3.   反向代理，负载均衡。当网站的访问量达到一定程度后，单台服务器不能满足用户的请求时，需要 用多台服务器集群可以使用nginx做反向代理。并且多台服务器可以平均分担负载，不会应为某台 服务器负载高宕机而某台服务器闲置的情况
4.   Nginx中也可以配置安全管理、比如可以使用Nginx搭建API接口网关，对每个接口服务进行拦截

>   Nginx静态资源

静态资源访问，就是存放在nginx的html页面，我们可以自己编写

>   为什么Nginx高性能

因为他的事件处理机制：异步非阻塞事件处理机制：运用了epol模型，提供了一个队列，排队解决

>   Nginx的特性

反向代理/L7负载均衡器

嵌入式Perl解释器

动态二进制升级

可用于重新编写 URL，具有非常好的PCRE 支持

>   Nginx如何处理请求

nginx接收一个请求后，首先由listen和server_name指令匹配server模块，再匹配server模块里的 location，location就是实际地址

>   Nginx如何处理HTTP请求

Nginx 使用反应器模式。主事件循环等待操作系统发出准备事件的信号，这样数据就可以从套接字读取，在该实例中读取到缓冲区并进行处理。单个线程可以提供数万个并发连接

>   在Nginx 中，如何使用未定义的服务器名称来阻止处理请求

只需将请求删除的服务器就可以定义为： 

Server {listen 80;server_name “ “ ;return 444;}

这里，服务器名被保留为一个空字符串，它将在没有"主机"头字段的情况下匹配请求，而一个特殊的Nginx 的非标准代码444被返回，从而终止连接

>   正向代理和反向代理

正向代理就是一个人发送一个请求直接就到达了目标的服务器

反方代理就是请求统一被Nginx接收，Nginx反向代理服务器接收到之后，按照一定的规则分发给后端的业务处理服务器进行处理

>   使用反向代理服务器的优点是什么

反向代理服务器可以隐藏源服务器的存在和特征。它充当互联网云和 web 服务器之间的中间层。这对于安全方面来说是很好的，特别是使用 web 托管服务时

>   Nginx 服务器的最佳用途

Nginx 服务器的最佳用法是在网络上部署动态HTTP 内容，使用 SCGI、WSGI应用程序服务器、用于脚本的FastCGI 处理程序。它还可以作负载均衡器

>   Nginx 服务器上的Master 和 Worker 进程分别是什么

Master进程：读取及评估配置和维持

Worker进程：处理请求

>   是否有可能将Nginx的错误替换为502、503

502=错误网关

503 =服务器超载 

有可能，但是您可以确保 fastcgi_intercept_errors 被设置为ON，并使用错误页面指令

>   在Nginx 中，如何在 URL 中保留双斜线

要在 URL 中保留双斜线，就必须使用 merge_slashes_off

语法：merge_slashes [on/off]

默认值：merge_slashes on 

环境：http,server

>   请解释 ngx_http_upstream_module 的作用是什么

ngx_http_upstream_module 用于定义可通过 fastcgi 传递、proxy 传递、uwsgi 传递、memcached 传递和 scgi传递指令来引用的服务器组

>   C10K问题

指无法同时处理大量客户端(10,000)的网络套接字

>   stub_status 和 sub_filter 指令的作用

Stub_status 指令：该指令用于了解Nginx当前状态，如当前的活动连接，接受和处理当前读/写/等待连接的总数 

Sub_filter 指令：它用于搜索和替换响应中的内容，并快速修复陈旧的数据

>   Nginx是否支持将请求压缩到上游

可以使用 Nginx模块gunzip将请求压缩到上游。gunzip 模块是一个过滤器，它可以对不支持"gzip"编码方法的客户机或服务器使用"内容编码：gzip"来解压缩响应

>   如何在 Nginx 中获得当前的时间

必须使用SSI模块、$date_gmt和$date_local 的变量

Proxy_set_header THE-TIME $date_gmt

>   用Nginx服务器解释 -s 的目的

用于运行 Nginx -s 参数的可执行文件

>   如何在 Nginx 服务器上添加模块

在编译过程中，必须选择Nginx模块，因为Nginx 不支持模块的运行时间选择

>   Nginx性能调优

1.   增加同时打开文件数open files数量
2.   处理大量静态文件的磁盘I/O时（此时worker进程是单线程的），增加CPU 核心数Norker Processes数量，提高计算能力
3.   如果网站流量很高，则可以提升worker进程连接数Worker Connections（默认1024）
4.   控制keep alive在10s-20s之间，减少连接的时间开销
5.   合理设置open file cache时间提高处理效率
6.   提高网路带宽
7.   开启压缩传输数据gzip，设置压缩级别gzip_comp_leve1为1-2，再高效果不明显并且浪费CPU了
8.   扩展机器数量

>   Nginx前端跨域问题

使用Nginx转发请求。把跨域的接口写成调本域的接口，然后将这些接口转发到真正的请求地址

>   Nginx虚拟主机怎么配置

1.   基于域名的虚拟主机，通过域名来区分虚拟主机一一应用：外部网站
2.   基于端口的虚拟主机，通过端口来区分虚拟主机一一应用：公司内部网站，外部网站的管理后台
3.   基于ip的虚拟主机

>   location的作用是什么

location指令的作用是根据用户请求的URI来执行不同的应用，也就是根据用户请求的网站URL进行匹配，匹配成功即进行相关的操作

>   限流

1.   正常限制访问频率（正常流量）
2.   突发限制访问频率（突发流量）
3.   限制并发连接数

Nginx的限流都是基于漏桶流算法

>   漏桶算法

漏桶算法是网络世界中流量整形或速率限制时经常使用的一种算法，它的主要目的是控制数据注入到网络的速率，平滑网络上的突发流量。漏桶算法提供了一种机制，通过它，突发流量可以被整形以便为网络提供一个稳定的流量。也就是我们刚才所讲的情况。漏桶算法提供的机制实际上就是刚 才的案例：突发流量会进入到一个漏桶，漏桶会按照我们定义的速率依次处理请求，如果水流过大也就是突发流量过大就会直接溢出，则多余的请求会被拒绝。所以漏桶算法能控制数据的传输速率

>   令牌桶算法

用的就是令牌桶控制算法。令牌桶算法的机制如下：存在一个大小固定的令牌桶，会以恒定的速率源源不断产生令牌。如果令牌消耗速率小于生产令牌的速度，令牌就会一直产生直至装满整个令牌桶

>   动静分离

Nginx是当下最热的Web容器，网站优化的重要点在于静态化网站，网站静态化的关键点则是是动静分离，动静分离是让动态网站里的动态网页根据一定规则把不变的资源和经常变的资源区分开来，动静资源做好了拆分以后，我们则根据静态资源的特点将其做缓存操作。 让静态的资源只走静态资源服务器，动态的走动态的服务器

Nginx的静态处理能力很强，但是动态处理能力不足，因此，在企业中常用动静分离技术。 对于静态资源比如图片，js，css等文件，我们则在反向代理服务器nginx中进行缓存。这样浏览器在请求一个静态资源时，代理服务器nginx就可以直接处理，无需将请求转发给后端服务器 tomcat。若用户请求的动态文件，比如servlet,jsp则转发给Tomcat服务器处理，从而实现动静分离。这也是反向代理服务器的一个重要的作用

>   Nginx负载均衡的算法怎么实现的

1.   轮询
2.   权重
3.   ip_hash(绑定)
4.   fair(第三方插件)  可以根据页面大小和加载时间长短智能地进行负载均衡，响应时间短的优先分配
5.   url_hash(第三方插件) 按访问url的hash结果来分配请求，使每个url定向到同一个后端服务器，可以进一步提高后端缓存服务器的效率

>   Nginx配置高可用性怎么配置

当上游服务器（真实访问服务器），一旦出现故障或者是没有及时相应的话，应该直接轮询到下一台服务器，保证服务器的高可用

